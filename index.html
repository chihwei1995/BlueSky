<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blue Sky Returns</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <script src="https://unpkg.com/globe.gl@4.6.8/dist/globe.gl.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" integrity="sha512-7eHRwcbYkK4d9g/6tD/mhkf++eoTHwpNM9woBxtPUBWm67zeAfFC+HrdoE2GanKeocly/VxeLvIqwvCdk7qScg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <style>
    :root {
      --bg1: #070911;
      --bg2: #040712;
      --glass: rgba(255, 255, 255, 0.06);
      --text: #e8ecff;
      --accent: #ff4d4d;
      --accent-secondary: #5c2222;
      --stroke: #ff4d4d;
      --button-shadow: 0 14px 40px rgba(0, 0, 0, 0.45);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at 20% 30%, rgba(255, 77, 77, 0.2), transparent 35%),
                  radial-gradient(circle at 80% 10%, rgba(0, 195, 255, 0.18), transparent 32%),
                  linear-gradient(135deg, var(--bg1), var(--bg2));
      color: var(--text);
      min-height: 100vh;
    }

    #globe-container {
      position: fixed;
      inset: 0;
      background: linear-gradient(160deg, #04060d 0%, #050915 45%, #01030a 100%);
    }

    #globe {
      width: 100vw;
      height: 100vh;
    }

    .atmosphere-overlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: radial-gradient(circle at 50% 50%, rgba(0, 210, 255, 0.08), transparent 55%);
      mix-blend-mode: screen;
      transition: background 0.6s ease;
    }

    .ui-layer {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 16px;
      pointer-events: none;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 16px;
      border-radius: 16px;
      background: linear-gradient(120deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.04));
      backdrop-filter: blur(14px);
      box-shadow: var(--button-shadow);
      pointer-events: auto;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      letter-spacing: 0.8px;
    }

    .logo-mark {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(255, 77, 77, 0.7), rgba(0, 210, 255, 0.7));
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.45);
    }

    .glass-panel {
      position: relative;
      pointer-events: auto;
      padding: 18px 20px;
      border-radius: 18px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.04));
      border: 1px solid rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(14px);
      box-shadow: var(--button-shadow);
    }

    .hero-text {
      font-size: clamp(24px, 3vw, 32px);
      font-weight: 700;
      margin: 0 0 6px;
      letter-spacing: 0.5px;
    }

    .subtext { margin: 0; opacity: 0.8; line-height: 1.5; max-width: 620px; }

    .control-row {
      display: flex;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    .mode-toggle {
      display: inline-flex;
      align-items: center;
      padding: 6px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.12);
      gap: 6px;
      box-shadow: var(--button-shadow);
    }

    .mode-btn {
      border: none;
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 700;
      color: var(--text);
      cursor: pointer;
      background: transparent;
      transition: all 0.35s ease;
    }

    .mode-btn.active[data-mode="crisis"] {
      background: linear-gradient(120deg, #ff4d4d, #7c1a1a);
      color: #fff;
      box-shadow: 0 10px 30px rgba(255, 77, 77, 0.35);
    }

    .mode-btn.active[data-mode="hope"] {
      background: linear-gradient(120deg, #14cba8, #0f4c3a);
      color: #e9fff9;
      box-shadow: 0 10px 30px rgba(46, 204, 113, 0.35);
    }

    .legend {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      padding: 10px 14px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
      box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.06);
    }

    .loading {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 10px 14px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(10px);
      font-weight: 600;
      letter-spacing: 0.6px;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      box-shadow: var(--button-shadow);
      pointer-events: none;
      z-index: 10;
    }

    .dot-pulse {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent);
      position: relative;
      box-shadow: 0 0 0 0 rgba(255, 77, 77, 0.6);
      animation: pulse 1.8s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255, 77, 77, 0.6); }
      70% { box-shadow: 0 0 0 14px rgba(255, 77, 77, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 77, 77, 0); }
    }

    .footer-note {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.07);
      pointer-events: auto;
      font-size: 14px;
      align-self: flex-start;
    }

    .footer-note strong { letter-spacing: 0.5px; }

    @media (max-width: 768px) {
      .ui-layer { padding: 10px; }
      header { flex-direction: column; align-items: flex-start; }
      .glass-panel { padding: 16px; }
    }
  </style>
</head>
<body>
  <div id="globe-container">
    <div id="globe"></div>
    <div class="atmosphere-overlay" id="atmosphereOverlay"></div>
    <div class="loading" id="loading">
      <div class="dot-pulse"></div>
      Loading real-world geography...
    </div>
  </div>

  <div class="ui-layer">
    <header>
      <div class="logo">
        <span class="logo-mark">üåå</span>
        <div>
          <div style="font-size:14px; opacity:0.7;">Blue Sky Returns</div>
          <div style="font-weight:700;">Interactive Earth</div>
        </div>
      </div>
      <div class="mode-toggle" aria-label="Toggle Crisis or Hope mode">
        <button class="mode-btn active" data-mode="crisis" id="btn-crisis">‚ö†Ô∏è Crisis</button>
        <button class="mode-btn" data-mode="hope" id="btn-hope">üåø Hope</button>
      </div>
    </header>

    <div class="glass-panel">
      <h1 class="hero-text">A living atlas of crisis and hope.</h1>
      <p class="subtext">Explore our planet in full 3D without texture downloads. Toggle between climate crisis and regenerative hope themes while the globe streams real Natural Earth polygons.</p>
      <div class="control-row">
        <div class="legend">
          <span class="legend-dot" id="legendLand" style="background:#5c2222;"></span>
          <span>Landmass polygons (real GeoJSON)</span>
        </div>
        <div class="legend">
          <span class="legend-dot" id="legendStroke" style="background:#ff4d4d;"></span>
          <span>Country borders</span>
        </div>
      </div>
    </div>

    <div class="footer-note">
      <strong>Data:</strong> Natural Earth Admin 0 ¬∑ Polygons rendered at altitude 0.005 with hover highlight.
    </div>
  </div>

  <script>
    const GEOJSON_URL = 'https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_110m_admin_0_countries.geojson';

    const THEMES = {
      crisis: {
        ocean: '#1a0505',
        land: '#5c2222',
        stroke: '#ff4d4d',
        atmosphere: '#c54141',
        background: ['#0b0303', '#120202'],
        overlay: 'radial-gradient(circle at 50% 50%, rgba(197, 65, 65, 0.15), transparent 60%)'
      },
      hope: {
        ocean: '#061836',
        land: '#0f4c3a',
        stroke: '#2ecc71',
        atmosphere: '#2cb6ff',
        background: ['#031022', '#020810'],
        overlay: 'radial-gradient(circle at 50% 50%, rgba(44, 182, 255, 0.18), transparent 60%)'
      }
    };

    const state = {
      mode: 'crisis',
      globe: null,
      polygons: [],
      hoverPolygon: null,
      textures: {}
    };

    const createSolidTexture = (color) => {
      const canvas = document.createElement('canvas');
      canvas.width = canvas.height = 2;
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = color;
      ctx.fillRect(0, 0, 2, 2);
      return canvas.toDataURL('image/png');
    };

    const prepareTextures = () => {
      state.textures.crisis = createSolidTexture(THEMES.crisis.ocean);
      state.textures.hope = createSolidTexture(THEMES.hope.ocean);
    };

    const applyTheme = (mode) => {
      state.mode = mode;
      const theme = THEMES[mode];
      document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.mode === mode));
      document.getElementById('legendLand').style.background = theme.land;
      document.getElementById('legendStroke').style.background = theme.stroke;

      gsap.to(':root', {
        duration: 0.8,
        '--bg1': theme.background[0],
        '--bg2': theme.background[1],
        '--accent': theme.stroke,
        '--accent-secondary': theme.land,
        '--stroke': theme.stroke,
        ease: 'power2.out'
      });

      const overlay = document.getElementById('atmosphereOverlay');
      overlay.style.background = theme.overlay;

      if (state.globe) {
        state.globe.globeImageUrl(state.textures[mode]);
        state.globe.atmosphereColor(theme.atmosphere);
        state.globe.polygonStrokeColor(() => theme.stroke);
        state.globe.polygonCapColor((poly) => poly === state.hoverPolygon ? new THREE.Color(theme.stroke).offsetHSL(0, 0.1, 0.1) : theme.land);
      }
    };

    const handleHover = (polygon) => {
      state.hoverPolygon = polygon;
      const theme = THEMES[state.mode];
      state.globe.polygonCapColor((poly) => poly === state.hoverPolygon ? new THREE.Color(theme.stroke).offsetHSL(0, 0.15, 0.15) : theme.land);
    };

    const initGlobe = async () => {
      const globe = Globe()(document.getElementById('globe'))
        .backgroundColor('rgba(0,0,0,0)')
        .atmosphereAltitude(0.18)
        .polygonsTransitionDuration(400)
        .polygonAltitude(() => 0.005)
        .polygonSideColor(() => 'rgba(255,255,255,0.06)')
        .polygonCapColor(() => THEMES[state.mode].land)
        .polygonStrokeColor(() => THEMES[state.mode].stroke)
        .onPolygonHover(handleHover)
        .onPolygonClick((polygon) => {
          if (!polygon || !polygon.properties) return;
          const name = polygon.properties.ADMIN || polygon.properties.name || 'Unknown';
          const region = polygon.properties.CONTINENT || 'Earth';
          const title = `${name}, ${region}`;
          gsap.to(globe.pointOfView(), {
            duration: 1.2,
            lat: polygon.center ? polygon.center.lat : 0,
            lng: polygon.center ? polygon.center.lng : 0,
            altitude: 1.8,
            onUpdate: function () {
              globe.pointOfView({ lat: this.targets().lat, lng: this.targets().lng, altitude: this.targets().altitude });
            },
            ease: 'power2.out'
          });
          const note = document.querySelector('.hero-text');
          note.textContent = `Viewing ${title}`;
        });

      const controls = globe.controls();
      controls.autoRotate = true;
      controls.autoRotateSpeed = 0.4;
      controls.enableDamping = true;
      controls.dampingFactor = 0.04;

      const resizer = () => {
        globe.width(window.innerWidth);
        globe.height(window.innerHeight);
      };
      window.addEventListener('resize', resizer);
      resizer();

      state.globe = globe;
    };

    const enrichPolygons = (features) => {
      return features.map((feature) => {
        const coords = feature?.properties?.LABEL_Y || feature?.properties?.LAT || 0;
        const lng = feature?.properties?.LABEL_X || feature?.properties?.LONG || 0;
        const center = { lat: Number(coords) || 0, lng: Number(lng) || 0 };
        return { ...feature, center };
      });
    };

    const loadGeoData = async () => {
      const response = await fetch(GEOJSON_URL);
      if (!response.ok) throw new Error('Failed to load GeoJSON.');
      const data = await response.json();
      const features = data.features || [];
      return enrichPolygons(features);
    };

    const bootstrap = async () => {
      prepareTextures();
      await initGlobe();
      applyTheme('crisis');

      const polygons = await loadGeoData();
      state.polygons = polygons;
      state.globe
        .globeImageUrl(state.textures[state.mode])
        .atmosphereColor(THEMES[state.mode].atmosphere)
        .polygonsData(polygons)
        .polygonLabel((d) => `${d.properties.ADMIN || d.properties.name}`);

      document.getElementById('loading').style.display = 'none';
    };

    document.getElementById('btn-crisis').addEventListener('click', () => applyTheme('crisis'));
    document.getElementById('btn-hope').addEventListener('click', () => applyTheme('hope'));

    bootstrap().catch((err) => {
      console.error(err);
      document.getElementById('loading').textContent = err.message;
    });
  </script>
</body>
</html>
